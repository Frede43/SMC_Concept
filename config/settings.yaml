# --- General Settings ---
general:
  bot_name: "Ultimate SMC Bot"
  version: "3.2"
  mode: "live"  # demo, live
  log_level: "DEBUG"

# --- Dashboard Web ---
dashboard:
  enabled: true
  port: 5000
  host: "0.0.0.0"

# --- Correlation Guard ---
correlation_guard:
  enabled: true
  max_exposure_per_currency: 0.25  # Lots max par devise (Conseil Expert: 0.25)
  max_positions_per_group: 2        # Positions max dans un groupe corrÃ©lÃ©

# --- Weekend Filter ---
weekend_filter:
  enabled: true
  friday_stop_new_trades_hour: 21  # ArrÃªt des nouveaux trades
  friday_close_positions: true      # Activer la fermeture AUTO (Forex uniquement)
  friday_close_positions_hour: 22   # Fermeture de sÃ©curitÃ©
  monday_start_hour: 1              # Reprise lundi matin
  timezone_offset: 2                # GMT+2 (Exness)

# --- MT5 Connection ---
mt5:
  login: 297641028  # Exness Real/Demo
  server: "Exness-MT5Trial9"
  path: "C:\\Program Files\\MetaTrader 5\\terminal64.exe"
  timeout: 60000

# --- Trading Universe ---
# âœ… CONFIGURATION Ã‰QUILIBRÃ‰E - 3 Symboles Forex Majeurs
symbols:
  - name: "EURUSDm"
    trade_weekend: false
    is_crypto: false
    risk_settings:
      allow_counter_trend: false
      block_mtf_conflict: true
      mtf_conflict_symbols: ["EURUSD", "GBPUSD"]
      
  - name: "GBPUSDm"
    trade_weekend: false
    is_crypto: false
    risk_settings:
      allow_counter_trend: false
      block_mtf_conflict: true
      mtf_conflict_symbols: ["EURUSD", "GBPUSD"]
  
  - name: "USDJPYm"    # âœ… RÃ‰ACTIVÃ‰
    trade_weekend: false
    is_crypto: false
    risk_settings:
      allow_counter_trend: false
      block_mtf_conflict: true
  
  # âŒ DÃ‰SACTIVÃ‰ pour compte 300$ (spread trop Ã©levÃ© relatif au capital)
  # RÃ©activer quand capital > 1000$
  # - name: "BTCUSDm"
  #   trade_weekend: true
  #   is_crypto: true
  #   max_spread: 3500
  #   risk_settings:
  #     sl_multiplier: 1.5
  #     use_atr_sl: true
  #     max_slippage_pips: 3000

  - name: "XAUUSDm"
    trade_weekend: false
    is_crypto: false
    risk_settings:
      max_slippage_pips: 30
  
  # - name: "US30m"
  #   trade_weekend: false
  #   is_crypto: false
  #   strategies:
  #     silver_bullet: true
  #     amd: true
  #     smt: true
  #   risk_settings:
  #     allow_counter_trend: false
  #     max_slippage_pips: 20
  #     max_spread: 100
  
  # - name: "USTECm"
  #   trade_weekend: false
  #   is_crypto: false
  #   strategies:
  #     silver_bullet: true
  #     amd: true
  #     smt: true
  #   risk_settings:
  #     allow_counter_trend: false
  #     max_slippage_pips: 20
  #     max_spread: 300

timeframes:
  ltf: "H1"   # RETOUR H1 (Plus stable)
  htf: "D1"   # D1 (Trend fort)
  
# --- Risk Management ---
# âš ï¸ OPTIMISÃ‰ POUR COMPTE 300$ - ULTRA CONSERVATEUR âš ï¸
risk:
  risk_per_trade: 0.20      # ğŸ›¡ï¸ RÃ‰DUIT Ã  0.20% = 0.60$ par trade (au lieu de 0.75$)
  max_daily_loss: 0.60      # ğŸ›¡ï¸ RÃ‰DUIT Ã  0.60% = max 2$ perte/jour (3 trades perdants max)
  max_open_trades: 2        # ğŸ›¡ï¸ RÃ‰DUIT Ã  2 (au lieu de 3) pour petit capital
  max_spread_pips: 2.0      # ğŸ›¡ï¸ STRICT 2 pips max (Ã©tait 5.0) pour Ã©viter trades coÃ»teux
  
  # ğŸ›¡ï¸ SECURITÃ‰ ANTI-DOUBLON (STACKING)
  min_stacking_distance_pips: 15.0 # âœ… AugmentÃ© Ã  15 pips (Ã©tait 5)
  min_stacking_time_seconds: 300   # âœ… AugmentÃ© Ã  5 min (Ã©tait 2 min)
  
  risk_reward:
    min: 2.5                # âœ… AUGMENTÃ‰ Ã  2.5:1 (Ã©tait 2.0) pour compenser spreads
    target: 4.0             # âœ… AUGMENTÃ‰ Ã  4:1 (Ã©tait 3.0) pour meilleure rentabilitÃ©
    
  management:
    break_even: true        
    break_even_trigger: 0.7 # ğŸ›¡ï¸ STRICT (10-12 pips) - SÃ©curiser TRÃˆS vite en M15
    break_even_offset: 2    
    partial_close: false    # âŒ DÃ‰SACTIVÃ‰ pour petit compte (lot 0.01 trop petit pour split)
    partial_close_trigger: 2.0
    partial_close_pct: 0.5
    trailing_stop: true     
    trailing_trigger: 2.5   # âœ… AUGMENTÃ‰ Ã  2.5R (Ã©tait 2.0R) - Trail aprÃ¨s bon profit
    trailing_dist: 1.0      # Trail large pour laisser respirer
    
  anti_tilt:
    enabled: true
    max_losing_streak: 2    # âœ… RÃ‰DUIT Ã  2 (Ã©tait 3) - Plus strict sur petit compte

# --- SMC Strategy Parameters ---
# âœ… OPTIMISÃ‰ - QualitÃ© + QuantitÃ© (LuxAlgo Recommendations)
smc:
  min_confidence: 0.65    # âœ… ASSOUPLIR Ã  0.65 (Ã©tait 0.70) - Ã‰quilibre optimal
  trend_filter: "balanced"  # âœ… CHANGÃ‰: balanced au lieu de strict - Plus flexible
  
  # ğŸ†• TREND STRENGTH FILTER (ADX) - OPTIMISÃ‰
  trend_strength:
    enabled: true
    min_adx: 18.0         # âœ… RÃ‰DUIT Ã  18 (Ã©tait 20) - Accepter tendances faibles/modÃ©rÃ©es
    adx_period: 14
    strict_mode: false     # âš–ï¸ DÃ‰SACTIVER strict - Mode recommandation seulement
  
  structure:
    swing_length: 5
    bos_confirmation: "body"
    choch_confirmation: "wick"
    require_htf_alignment: false  # âœ… DÃ‰SACTIVER - GÃ©rÃ© par le nouveau scoring pondÃ©rÃ©
    
  order_blocks:
    mitigation_type: "wick"
    max_age_candles: 50
    require_retest: false      # Pas de retest obligatoire
    min_strength: 0.60         # âš–ï¸ RÃ‰DUIT Ã  0.60 (Ã©tait 0.70)
    
  fvg:
    min_size_pips: 3.0      # âš–ï¸ RÃ‰DUIT Ã  3.0 (Ã©tait 5.0) - Accepter FVG moyens
    mitigation_threshold: 0.5
    require_structure_confluence: false  # âš–ï¸ DÃ‰SACTIVER (Ã©tait true)
    
  liquidity:
    sweep_lookback: 10
    min_wick_ratio: 0.2
    require_confirmation: false  # âš–ï¸ DÃ‰SACTIVER (Ã©tait true) - Trop strict
    min_sweep_strength: 0.60    # âš–ï¸ RÃ‰DUIT Ã  0.60 (Ã©tait 0.70)
    
  # Killzones (Sessions Actives) - ASSOUPLIR
  killzones:
    strict_mode: false  # âš–ï¸ DÃ‰SACTIVER strict - Autoriser hors killzones
    timezone_offset: 2  # GMT+2
    
    asian:
      enabled: false    # âŒ DÃ‰SACTIVÃ‰ - Trop de faux signaux
      start: "00:00"
      end: "08:00"
      
    london:
      enabled: true     # âœ… ACTIVÃ‰ - Session haute probabilitÃ©
      start: "08:00"
      end: "11:00"      # Raccourci (fin chevauchement NY)
      min_volume_percentile: 60  # ğŸ†• Volume minimum requis
      
    new_york:
      enabled: true     # âœ… ACTIVÃ‰ - Session principale
      start: "13:00"
      end: "16:00"
      min_volume_percentile: 60  # ğŸ†• Volume minimum requis
      
    # Silver Bullet (haute probabilitÃ©)
    silver_bullet:
      enabled: true
      strict: true
      am_start: "09:00"
      am_end: "10:00"
      pm_start: "14:00"
      pm_end: "15:00"
      
  strategies:
    - "pdh_pdl_sweep"     
    - "asian_range_sweep" 

  smt:
    enabled: true
    pairs:
      US30m:
        corr_symbol: "USTECm"
        type: "positive"  # Si US30 monte, USTEC doit monter. Si divergence = Signal
      USTECm:
        corr_symbol: "US30m"
        type: "positive"
      EURUSDm:
        corr_symbol: "GBPUSDm"
        type: "positive"  # DXY correlation inverse (classique)
      GBPUSDm:
        corr_symbol: "EURUSDm"
        type: "positive"

# --- Filters ---
filters:
  ma_trend:
    enabled: true
    period: 200
    timeframe: "D1"
    
  rsi:
    enabled: true
    period: 14
    overbought: 70
    oversold: 30
    
  news:
    enabled: true
    mode: "real"  # ğŸ†• CHANGÃ‰: real au lieu de simulated (multi-source: ForexFactory + TradingView + MyFxBook)
    minutes_before: 45  # âœ… 45min avant
    minutes_after: 45   # âœ… 45min aprÃ¨s
    filter_high_impact: true
    filter_medium_impact: true  # âœ… Bloquer aussi MEDIUM impact
    
    # ğŸ†• OPTIMISÃ‰: FenÃªtre Ã©largie pour certains MEDIUM events critiques
    medium_impact_window:
      minutes_before: 120  # 2h avant (au lieu de 45min)
      minutes_after: 60    # 1h aprÃ¨s
    
    # ğŸ†• NOUVEAU: Liste events MEDIUM Ã  traiter comme HIGH impact
    critical_medium_events:
      - "Retail Sales"
      - "Core PPI"
      - "Building Permits"
      - "Housing Starts"
      - "Fed Chair Powell Speaks"
      - "FOMC Member Williams Speaks"
      - "ISM Manufacturing PMI"
      - "Michigan Consumer Sentiment"
    
    # ğŸ†• NOUVEAU: Alertes proactives
    proactive_alerts:
      enabled: true
      alert_hours_before: 4  # Notification Discord/Telegram 4h avant news critique
      alert_high_only: true   # Seulement pour HIGH impact
    
  advanced:
    min_volume_percentile: 50 # Volume relatif requis
    atr_threshold: 1.0       # VolatilitÃ© minimale

# --- Fundamental Analysis (NOUVEAU) ---
fundamental:
  enabled: true  # Master switch (mettre false pour dÃ©sactiver complÃ¨tement)
  
  # Poids des composants dans le score final (total doit faire ~1.0)
  weights:
    news: 0.25         # 25% - Impact des news Ã  venir
    cot: 0.25          # ğŸ“‰ 25% - COT (DonnÃ©e retardÃ©e de 3 jours)
    intermarket: 0.50  # ğŸ“ˆ 50% - Intermarket Temps RÃ©el (DXY/VIX est roi)
  
  # Seuils de dÃ©cision
  # Seuils de dÃ©cision (DURCIS)
  block_threshold: -30    # Score < -30 â†’ Bloquer trade (divergence macro significative)
  reduce_threshold: -15   # Score < -15 â†’ RÃ©duire position (doute macro)
  boost_threshold: 40     # Score > 40 â†’ Booster position (confluence forte)
  
  # Filtre News
  news_filter:
    enabled: true
    block_before_minutes: 30  # Bloquer X min avant news HIGH impact
    block_after_minutes: 30   # Bloquer X min aprÃ¨s
    high_impact_only: false   # false = inclure MEDIUM aussi
    # Note: NÃ©cessite 'pip install investpy'
  
  # Analyse COT (Commitments of Traders)
  cot_analysis:
    enabled: true  # ActivÃ© (Source: CFTC.gov)
    extreme_threshold: 2.0  # Ã‰carts-types pour considÃ©rer "extrÃªme"
    update_frequency: "weekly"  # COT publiÃ© le vendredi
    # Note: NÃ©cessite implÃ©mentation source donnÃ©es (voir core/cot_analyzer.py)
  
  # Intermarket Analysis
  intermarket:
    enabled: true
    risk_off_vix_threshold: 20  # VIX > 20 = Risk-off
    # Note: NÃ©cessite 'pip install yfinance'

# --- Advanced Strategy Filters (OVERRIDE) ---
advanced_filters:
  structure:
    allow_counter_trend: false  # ğŸ”’ SECURITY BLOCK: Tendance UNIQUEMENT
    strict_mode: true
