# --- General Settings ---
general:
  bot_name: "Ultimate SMC Bot"
  version: "3.3"  # ğŸ†• Bumped version
  mode: "live"  # demo, live
  log_level: "DEBUG"
  trading_mode: "micro_account"  # ğŸ†• conservative, balanced, balanced_plus, aggressive, micro_account

# --- Trading Modes Configuration ---
# ğŸ†• SYSTÃˆME DE MODES ADAPTATIFS
trading_modes:
  conservative:
    description: "Mode ultra-sÃ©lectif - Max qualitÃ©, min trades (capital > 10k$)"
    min_confidence: 0.75
    max_spread_pips: 3.0
    max_open_trades: 3
    risk_per_trade: 0.40
    filters:
      all_active: true
      news_medium_impact: true
      adr_exhaustion_check: true
      round_numbers_check: true
    smc:
      min_ob_strength: 0.70
      min_sweep_strength: 0.70
      min_fvg_size_pips: 5.0
      swing_length: 50
      
  balanced:
    description: "Mode Ã©quilibrÃ© - Bon compromis (capital 5-10k$)"
    min_confidence: 0.65
    max_spread_pips: 4.0
    max_open_trades: 5
    risk_per_trade: 0.50
    filters:
      all_active: true
      news_medium_impact: false
      adr_exhaustion_check: true
      round_numbers_check: false
    smc:
      min_ob_strength: 0.60
      min_sweep_strength: 0.60
      min_fvg_size_pips: 3.0
      swing_length: 50
      
  balanced_plus:
    description: "ğŸ†• Mode recommandÃ© pour 2-5k$ - Plus d'opportunitÃ©s"
    min_confidence: 0.55  # ğŸš€ Assoupli
    max_spread_pips: 4.5
    max_open_trades: 5
    risk_per_trade: 0.50
    filters:
      essential_only: true  # ğŸ†• Seulement filtres essentiels
      news_medium_impact: false
      adr_exhaustion_check: false  # ğŸš€ DÃ©sactivÃ©
      round_numbers_check: false   # ğŸš€ DÃ©sactivÃ©
    smc:
      min_ob_strength: 0.55  # ğŸš€ Assoupli
      min_sweep_strength: 0.55  # ğŸš€ Assoupli
      min_fvg_size_pips: 2.5  # ğŸš€ Assoupli
      swing_length: 50
      htf_alignment_weight: 0.25  # ğŸ†• RÃ©duit (Ã©tait 0.40)
      
  aggressive:
    description: "Mode agressif - Max trades (capital > 5k$, expÃ©rimentÃ©)"
    min_confidence: 0.50
    max_spread_pips: 5.0
    max_open_trades: 7
    risk_per_trade: 0.60
    filters:
      essential_only: true
      news_medium_impact: false
      adr_exhaustion_check: false
      round_numbers_check: false
    smc:
      min_ob_strength: 0.50
      min_sweep_strength: 0.50
      min_fvg_size_pips: 2.0
      swing_length: 50  # ğŸš€ Plus rÃ©actif (mais alignÃ© avec Pine Script pour cohÃ©rence)
      htf_alignment_weight: 0.20  # ğŸ†• Encore moins de poids

  micro_account:
    description: "ğŸ›¡ï¸ SpÃ©cial petit compte (100$) - Gestion stricte lot minimal"
    min_confidence: 0.70      # Haute qualitÃ© requise uniquement
    max_spread_pips: 2.5      # Spread serrÃ© vital (ne pas payer trop cher)
    max_open_trades: 2        # Max 2 positions simultanÃ©es (Safe)
    risk_per_trade: 2.0       # 2% = 2$ = ~20 pips SL @ 0.01 (NÃ©cessaire mathÃ©matiquement)
    filters:
      all_active: true
      news_medium_impact: true # Ã‰viter volatilitÃ© inutile (SL hunt)
      adr_exhaustion_check: true
      round_numbers_check: true
    smc:
      min_ob_strength: 0.70
      min_sweep_strength: 0.70
      min_fvg_size_pips: 3.0
      swing_length: 50        # AlignÃ© SMC Standard

# --- Dashboard Web ---
dashboard:
  enabled: true
  port: 5000
  host: "0.0.0.0"

# --- Correlation Guard ---
correlation_guard:
  enabled: true
  max_exposure_per_currency: 0.25  # Lots max par devise (Conseil Expert: 0.25)
  max_positions_per_group: 2        # Positions max dans un groupe corrÃ©lÃ©

# --- Weekend Filter ---
weekend_filter:
  enabled: true
  friday_stop_new_trades_hour: 21  # ArrÃªt des nouveaux trades
  friday_close_positions: true      # Activer la fermeture AUTO (Forex uniquement)
  friday_close_positions_hour: 22   # Fermeture de sÃ©curitÃ©
  monday_start_hour: 1              # Reprise lundi matin
  timezone_offset: 2                # GMT+2 (Exness)

# --- MT5 Connection ---
mt5:
  login: 297641028  # Exness Real/Demo
  server: "Exness-MT5Trial9"
  path: "C:\\Program Files\\MetaTrader 5\\terminal64.exe"
  timeout: 60000

# --- Trading Universe ---
# âœ… CONFIGURATION FOREX UNIQUEMENT - 3 Paires Majeures
symbols:
  - name: "EURUSDm"
    trade_weekend: false
    is_crypto: false
    risk_settings:
      allow_counter_trend: false # ğŸ”´ FIX #3: BLOQUÃ‰ sur EURUSD
      block_mtf_conflict: true
      mtf_conflict_symbols: ["EURUSD", "GBPUSD"]
      
  - name: "GBPUSDm"
    trade_weekend: false
    is_crypto: false
    risk_settings:
      allow_counter_trend: false # ğŸ”´ FIX #3: BLOQUÃ‰ sur GBPUSD
      block_mtf_conflict: true
      mtf_conflict_symbols: ["EURUSD", "GBPUSD"]
  
  - name: "USDJPYm"
    trade_weekend: false
    is_crypto: false
    risk_settings:
      allow_counter_trend: false # ğŸ”´ FIX #3: BLOQUÃ‰ sur USDJPY (CRITIQUE)
      block_mtf_conflict: true

timeframes:
  ltf: "H1"   # RETOUR H1 (Plus stable)
  htf: "D1"   # D1 (Trend fort)
  
# --- Risk Management ---
# ğŸ”´ FIX CRITIQUE: Configuration anti-overtrading + discipline stricte
risk:
  risk_per_trade: 0.50      # 0.50% = ~21.50$ par trade (micro-account adaptÃ©)
  max_daily_loss: 1.50      # 1.50% = ~64.50$ max perte/jour (3 trades perdants)
  max_open_trades: 3        # ğŸ”´ FIX #1: RÃ‰DUIT Ã  3 (Ã©tait 5) - Anti-overtrading
  max_spread_pips: 4.0      # 4.0 pips max spread
  
  # ğŸ”´ FIX #1: ANTI-OVERTRADING STRICT
  max_trades_per_day: 3            # ğŸ†• Maximum 3 trades par jour (Ã©tait illimitÃ©)
  max_trades_per_symbol_per_day: 2 # ğŸ†• Max 2 trades par paire/jour
  min_stacking_time_seconds: 3600  # ğŸ”´ FIX: 1 heure entre trades (Ã©tait 3min)
  cooldown_same_symbol_seconds: 1800  # ğŸ†• 30 min cooldown par symbole
  
  # ğŸ†• BOS STRENGTH FILTER (100% SMC)
  # Remplace le filtre RSI. Bloque les trades contre une impulsion forte (> 2.5 ATR)
  impulsive_regime_filter:
    enabled: true
    bos_strong_threshold: 2.5   # Seuil Strong Impulsion (en ATR)
    block_counter_trend: true
    allow_with_smt_divergence: true
    allow_with_sweep_fvg: true
  
  # ğŸ›¡ï¸ SECURITÃ‰ ANTI-DOUBLON (STACKING)
  min_stacking_distance_pips: 15.0 # ğŸ”´ FIX: AugmentÃ© Ã  15 pips (Ã©tait 10) - Plus strict
  
  risk_reward:
    min: 2.0                # âš¡ Minimum 2:1 pour setups haute probabilitÃ©
    target: 3.0             # ğŸ”´ FIX #4: RÃ©duit Ã  3:1 (Ã©tait 4:1) - Plus rÃ©aliste
    
  management:
    break_even: true        
    break_even_trigger: 0.7 # SÃ©curiser Ã  0.7R (10-12 pips)
    break_even_offset: 2    
    partial_close: true     # âœ… ACTIVÃ‰ pour capital suffisant
    partial_close_trigger: 1.5  # ğŸ”´ FIX #4: Prendre 50% Ã  1.5R (Ã©tait 2.0R) - Plus tÃ´t
    partial_close_pct: 0.5      # Fermer 50% de la position
    trailing_stop: true     
    trailing_mode: "structure" # ğŸ†• SMC PUR: Suivre les swings (Fractals)
    trailing_trigger: 1.5   # ğŸ”´ FIX #4: Trail Ã  1.5R (Ã©tait 2.0R) - SÃ©curiser plus tÃ´t
    trailing_dist: 1.0      # Trail large pour laisser respirer
    
  anti_tilt:
    enabled: true
    max_losing_streak: 2    # ğŸ”´ FIX: RÃ‰DUIT Ã  2 (Ã©tait 3) - Stop plus tÃ´t si sÃ©rie de pertes

# --- SMC Strategy Parameters ---
# âœ… OPTIMISÃ‰ - QualitÃ© + QuantitÃ© (LuxAlgo Recommendations)
smc:
  pure_smc_mode: true     # ğŸ†• DÃ‰SACTIVER les indicateurs lagging (EMA, etc.)
  min_confidence: 0.65    # âœ… ASSOUPLIR Ã  0.65 (Ã©tait 0.70) - Ã‰quilibre optimal
  trend_filter: "balanced"  # âœ… CHANGÃ‰: balanced au lieu de strict - Plus flexible
  
  # ğŸ†• TREND STRENGTH FILTER (ADX) - OPTIMISÃ‰
  trend_strength:
    enabled: true
    min_adx: 18.0         # âœ… RÃ‰DUIT Ã  18 (Ã©tait 20) - Accepter tendances faibles/modÃ©rÃ©es
    adx_period: 14
    strict_mode: false     # âš–ï¸ DÃ‰SACTIVER strict - Mode recommandation seulement
  
  structure:
    swing_length: 50           # âœ… ALIGNÃ‰ AVEC PINE SCRIPT (Ã©tait 5)
    bos_confirmation: "body"
    choch_confirmation: "wick"
    require_htf_alignment: true   # ğŸ”´ FIX #3: ACTIVÃ‰ - Bloquer contre-tendance HTF
    
  order_blocks:
    mitigation_type: "wick"
    max_age_candles: 50
    require_retest: false      # Pas de retest obligatoire
    min_strength: 0.60         # âš–ï¸ RÃ‰DUIT Ã  0.60 (Ã©tait 0.70)
    
  fvg:
    min_size_pips: 3.0      # âš–ï¸ RÃ‰DUIT Ã  3.0 (Ã©tait 5.0) - Accepter FVG moyens
    mitigation_threshold: 0.5
    require_structure_confluence: false  # âš–ï¸ DÃ‰SACTIVER (Ã©tait true)
    
  liquidity:
    sweep_lookback: 10
    min_wick_ratio: 0.2
    require_confirmation: false  # âš–ï¸ DÃ‰SACTIVER (Ã©tait true) - Trop strict
    min_sweep_strength: 0.60    # âš–ï¸ RÃ‰DUIT Ã  0.60 (Ã©tait 0.70)
    
  # Killzones (Sessions Actives) - ASSOUPLIR
  killzones:
    strict_mode: false  # âš–ï¸ DÃ‰SACTIVER strict - Autoriser hors killzones
    timezone_offset: 2  # GMT+2
    
    asian:
      enabled: false    # âŒ DÃ‰SACTIVÃ‰ - Trop de faux signaux
      start: "00:00"
      end: "08:00"
      
    london:
      enabled: true     # âœ… ACTIVÃ‰ - Session haute probabilitÃ©
      start: "08:00"
      end: "11:00"      # Raccourci (fin chevauchement NY)
      min_volume_percentile: 60  # ğŸ†• Volume minimum requis
      
    new_york:
      enabled: true     # âœ… ACTIVÃ‰ - Session principale
      start: "13:00"
      end: "16:00"
      min_volume_percentile: 60  # ğŸ†• Volume minimum requis
      
    # Silver Bullet (haute probabilitÃ©)
    silver_bullet:
      enabled: true
      strict: true
      am_start: "09:00"
      am_end: "10:00"
      pm_start: "14:00"
      pm_end: "15:00"
      
  strategies:
    - "pdh_pdl_sweep"     
    - "asian_range_sweep" 

  smt:
    enabled: true
    pairs:
      # âœ… Configuration SMT pour paires Forex uniquement
      EURUSDm:
        corr_symbol: "GBPUSDm"
        type: "positive"  # DXY correlation inverse (classique)
      GBPUSDm:
        corr_symbol: "EURUSDm"
        type: "positive"

# --- Filters ---
filters:
  ma_trend:
    enabled: false        # âŒ PURE SMC: Pas de Moyenne Mobile (Lagging)
    period: 200
    timeframe: "D1"
    
  rsi:
    enabled: false         # âŒ PURE SMC: DÃ‰SACTIVÃ‰ (RemplacÃ© par BOS Strength)
    period: 14
    overbought: 70
    oversold: 30
    
  news:
    enabled: true
    mode: "real"  # Multi-source (ForexFactory + TradingView)
    minutes_before: 30  # ğŸš€ RÃ‰DUIT Ã  30min (Ã©tait 45min) - Plus flexible
    minutes_after: 30   # ğŸš€ RÃ‰DUIT Ã  30min (Ã©tait 45min) - Plus flexible
    filter_high_impact: true    # Bloquer uniquement HIGH impact
    filter_medium_impact: false # ğŸš€ DÃ‰SACTIVÃ‰ - Ne plus bloquer MEDIUM impact
    
    # âš ï¸ FenÃªtre pour events MEDIUM dÃ©sactivÃ©e (medium_impact_window supprimÃ©e)
    
    # ğŸ†• Liste events critiques Ã  bloquer mÃªme si MEDIUM
    critical_medium_events:
      - "FOMC Rate Decision"       # Toujours critique
      - "NFP"                      # Non-Farm Payrolls
      - "Fed Chair Powell Speaks"  # Discours Fed critique
    
    # ğŸ†• Alertes proactives (notifications uniquement, pas de blocage)
    proactive_alerts:
      enabled: true
      alert_hours_before: 2  # ğŸš€ RÃ‰DUIT Ã  2h (Ã©tait 4h) - Moins intrusif
      alert_high_only: true  # Seulement pour HIGH impact
    
  advanced:
    min_volume_percentile: 70 # ğŸ”´ FIX: Volume relatif requis (Ã©tait 50) - Plus strict
    atr_threshold: 1.0       # VolatilitÃ© minimale
    adr_max_percent: 100.0   # ğŸ”´ FIX #2: ADR max 100% (bloquer si dÃ©passÃ©)
    strict_adr_block: true   # ğŸ”´ FIX #2: Mode strict ADR (bloquer, pas juste warning)

# --- Fundamental Analysis (NOUVEAU) ---
fundamental:
  enabled: true  # Master switch (mettre false pour dÃ©sactiver complÃ¨tement)
  
  # Poids des composants dans le score final (total doit faire ~1.0)
  weights:
    news: 0.25         # 25% - Impact des news Ã  venir
    cot: 0.25          # ğŸ“‰ 25% - COT (DonnÃ©e retardÃ©e de 3 jours)
    intermarket: 0.50  # ğŸ“ˆ 50% - Intermarket Temps RÃ©el (DXY/VIX est roi)
  
  # Seuils de dÃ©cision
  # Seuils de dÃ©cision (DURCIS)
  block_threshold: -30    # Score < -30 â†’ Bloquer trade (divergence macro significative)
  reduce_threshold: -15   # Score < -15 â†’ RÃ©duire position (doute macro)
  boost_threshold: 40     # Score > 40 â†’ Booster position (confluence forte)
  
  # Filtre News
  news_filter:
    enabled: true
    block_before_minutes: 30  # Bloquer X min avant news HIGH impact
    block_after_minutes: 30   # Bloquer X min aprÃ¨s
    high_impact_only: false   # false = inclure MEDIUM aussi
    # Note: NÃ©cessite 'pip install investpy'
  
  # Analyse COT (Commitments of Traders)
  cot_analysis:
    enabled: true  # ActivÃ© (Source: CFTC.gov)
    extreme_threshold: 2.0  # Ã‰carts-types pour considÃ©rer "extrÃªme"
    update_frequency: "weekly"  # COT publiÃ© le vendredi
    # Note: NÃ©cessite implÃ©mentation source donnÃ©es (voir core/cot_analyzer.py)
  
  # Intermarket Analysis
  intermarket:
    enabled: true
    risk_off_vix_threshold: 20  # VIX > 20 = Risk-off
    # Note: NÃ©cessite 'pip install yfinance'

# --- Advanced Strategy Filters (OVERRIDE) ---
advanced_filters:
  structure:
    allow_counter_trend: false  # ğŸ”´ FIX #3: BLOQUÃ‰ - Interdire contre-tendance HTF
    strict_mode: true          # ğŸ”´ FIX: Mode strict activÃ© (discipline)
